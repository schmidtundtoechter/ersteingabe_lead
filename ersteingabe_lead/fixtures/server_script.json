[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-02-06 15:23:06.306045",
  "module": "Ersteingabe Lead",
  "name": "Ersteingabe Lead Script",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Ersteingabe Lead",
  "script": "# Server Script for \"Ersteingabe Lead AZ-IT\"\n# Trigger: Before Save\n\n# NOCHWAS NEU\n\n# Step 1: Create the 'kompletter_name' based on 'vornahme', 'zweiter_vornahme', 'nachnahme'\nname_parts = []\n\nif doc.vornahme:\n    name_parts.append(doc.vornahme)\n\nif doc.zweiter_vornahme:\n    name_parts.append(doc.zweiter_vornahme)\n\nif doc.nachnahme:\n    name_parts.append(doc.nachnahme)\n\n# Zusammensetzen der Namensteile mit Leerzeichen\ndoc.kompletter_name = \" \".join(name_parts)\n\n# Step 2: Create new Lead entry\nnew_lead = frappe.get_doc({\n    \"doctype\": \"Lead\",\n    \"status\": \"Lead\",\n    \"custom_status_intern\": \"Lead\",\n    \"company_name\": doc.hfz,\n    \"custom_thema\": doc.thema,\n    \"custom_leadquelle\": doc.leadquelle,\n    \"job_title\": doc.position,\n    \"salutation\": doc.anrede,\n    \"first_name\": doc.vornahme,\n    \"middle_name\": doc.zweiter_vornahme,\n    \"last_name\": doc.nachnahme,\n    \"lead_name\": doc.kompletter_name,\n    \"gender\": doc.geschlecht,\n    \"custom_adresse_mutterunternehmen\": doc.adresse_mutterunternehmen,\n    \"custom_kontakt_mutterunternehmen\": doc.kontakt_mutterunternehmen,\n    \"no_of_employees\": doc.select_lapl,\n    \"industry\": doc.wirtschaftsbranche,\n    \"custom_straße\": doc.adresse_zeile_1,\n    \"custom_hausnummer\": doc.adresse_zeile_2,\n    \"custom_ort\": doc.ort_wohnort,\n    \"custom_plz\": doc.plz,\n    \"custom_land\": doc.land,\n    \"address_html\": doc.webseite,\n    \"campaign_name\": doc.kampagnenname,\n    \"language\": doc.drucksprache,\n    \"disabled\": doc.deaktiviert,\n    \"unsubscribed\": doc.unsubscribed,\n    \"blog_subscriber\": doc.blog_subscriber,\n    \"company\": \"AZ IT-Systems & Consulting GmbH\",\n    \"custom_tel_zentrale\": doc.telefon_zentrale,\n    \"email_id\" : doc.email,\n    \"website\" : doc.webseite\n    \n})\n\n# Speichern des Leads\nnew_lead.insert(ignore_permissions=True)\n\n# Step 3: Remove automatically generated Contact (if any)\nauto_contact = frappe.get_all(\"Contact\", filters={\"link_doctype\": \"Lead\", \"link_name\": new_lead.name})\nif auto_contact:\n    for contact in auto_contact:\n        frappe.delete_doc(\"Contact\", contact.name, ignore_permissions=True)\n\n# Step 4: Create new Contact entry\nnew_contact = frappe.get_doc({\n    \"doctype\": \"Contact\",\n    \"custom_präfix\": doc.titel,\n    \"first_name\": doc.vornahme,\n    \"middle_name\": doc.zweiter_vornahme,\n    \"last_name\": doc.nachnahme,\n    \"salutation\": doc.anrede,\n    \"designation\": doc.position,\n    \"gender\": doc.geschlecht,\n    \"company_name\": doc.hfz,\n    \"status\": \"Passive\",\n    \"is_primary_contact\": doc.ist_hauptkontakt,\n    \"is_billing_contact\": doc.ist_primärer_rechnungskontakt,\n    \"department\": doc.abteilung\n})\n\n# Speichern des Kontakts\nnew_contact.insert(ignore_permissions=True)\n\n# Step 5: Add phone numbers\nif doc.telefon:\n    new_contact.append(\"phone_nos\", {\n        \"phone\": doc.telefon,\n        \"is_primary_phone\": 1\n    })\n\nif doc.telefon_zentrale:\n    new_contact.append(\"phone_nos\", {\n        \"phone\": doc.telefon_zentrale\n    })\n\n# Speichern des Kontakts nach dem Hinzufügen der Telefonnummern\nnew_contact.save(ignore_permissions=True)\n\n# Step 6: Add email addresses\nif doc.email_ansprechpartner:\n    new_contact.append(\"email_ids\", {\n        \"email_id\": doc.email_ansprechpartner,\n        \"is_primary\": 1\n    })\n\nif doc.email:\n    new_contact.append(\"email_ids\", {\n        \"email_id\": doc.email\n    })\n\n# Speichern des Kontakts nach dem Hinzufügen der E-Mail-Adressen\nnew_contact.save(ignore_permissions=True)\n\n# Step 7: Create new Address entry\nnew_address = frappe.get_doc({\n    \"doctype\": \"Address\",\n    \"address_title\": doc.kompletter_name,\n    \"address_type\": \"Other\",\n    \"address_line1\": doc.adresse_zeile_1,\n    \"address_line2\": doc.adresse_zeile_2,\n    \"city\": doc.ort_wohnort,\n    \"county\": doc.land,\n    \"pincode\": doc.plz,\n    \"email_id\": doc.email,\n    \"phone\": doc.telefon,\n    \"is_primary_address\": doc.ist_hauptkontakt,\n    \"is_shipping_address\": doc.ist_versandanschrift\n})\n\n# Link Address to Lead\nnew_address.append(\"links\", {\n    \"link_doctype\": \"Lead\",\n    \"link_name\": new_lead.name\n})\n\n# Speichern der Adresse\nnew_address.insert(ignore_permissions=True)\n\n# Step 8: Update Lead with Contact ID\nnew_lead.custom_aktueller_primärkontakt = new_contact.name\nnew_lead.save(ignore_permissions=True)\n\n# Step 9: Add the link from Contact to Lead\nnew_contact.append(\"links\", {\n    \"link_doctype\": \"Lead\",\n    \"link_name\": new_lead.name,\n    \"link_title\": new_lead.lead_name\n})\n\n# Speichern des Kontakts nach Hinzufügen des Links\nnew_contact.save(ignore_permissions=True)\n\n\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-02-06 15:48:40.458459",
  "module": "Ersteingabe Lead",
  "name": "Testscript",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Lead",
  "script": "pass",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-02-06 16:32:20.672830",
  "module": "Ersteingabe Lead",
  "name": "Testscript (nur vom Code)",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Lead",
  "script": "pass",
  "script_type": "Scheduler Event"
 }
]